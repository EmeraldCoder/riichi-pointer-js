<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Riichi Mahjong Pointer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
    <div id="layout">
        <h1>Riichi Mahjong Pointer</h1>
        
        <div data-bind="{visible: currentView() === 'TileSuitSelection'}">
            <h2>Select type tile type of the combinaison to add to your hand</h2>

            <input type="button" value="Dragon" data-bind="{click: selectSuit.bind($data, 'dragon'), visible: addType() !== 'chii'}" />
            <input type="button" value="Wind" data-bind="{click: selectSuit.bind($data, 'wind'), visible: addType() !== 'chii'}" />
            <input type="button" value="Dot" data-bind="{click: selectSuit.bind($data, 'dot')}" />
            <input type="button" value="Bamboo" data-bind="{click: selectSuit.bind($data, 'bamboo')}" />
            <input type="button" value="Character" data-bind="{click: selectSuit.bind($data, 'character')}" />    
        </div>
        
        <div data-bind="{visible: currentView() === 'TileValueSelection'}">
            <h2>Select the value of the tile of the combinaison to add to your hand</h2>
            
            <div data-bind="{visible: addSuit() === 'dragon'}">
                <input type="button" value="Green" data-bind="{click: selectValue.bind($data, 'green')}" />
                <input type="button" value="Red" data-bind="{click: selectValue.bind($data, 'red')}" />
                <input type="button" value="White" data-bind="{click: selectValue.bind($data, 'white')}" />
            </div>
            <div data-bind="{visible: addSuit() === 'wind'}">
                <input type="button" value="East" data-bind="{click: selectValue.bind($data, 'east')}" />
                <input type="button" value="South" data-bind="{click: selectValue.bind($data, 'south')}" />
                <input type="button" value="West" data-bind="{click: selectValue.bind($data, 'west')}" />
                <input type="button" value="North" data-bind="{click: selectValue.bind($data, 'north')}" />
            </div>
            <div data-bind="{visible: addSuit() !== 'dragon' && addSuit() !== 'wind'}">
                <input type="button" value="1" data-bind="{click: selectValue.bind($data, 1)}" />
                <input type="button" value="2" data-bind="{click: selectValue.bind($data, 2)}" />
                <input type="button" value="3" data-bind="{click: selectValue.bind($data, 3)}" />
                <input type="button" value="4" data-bind="{click: selectValue.bind($data, 4)}" />
                <input type="button" value="5" data-bind="{click: selectValue.bind($data, 5)}" />
                <input type="button" value="6" data-bind="{click: selectValue.bind($data, 6)}" />
                <input type="button" value="7" data-bind="{click: selectValue.bind($data, 7)}" />
                <input type="button" value="8" data-bind="{click: selectValue.bind($data, 8), visible: addType() !== 'chii'}" />
                <input type="button" value="9" data-bind="{click: selectValue.bind($data, 9), visible: addType() !== 'chii'}" />
            </div>
        </div>

        <div data-bind="{visible: currentView() === 'Main'}">
            <h2>Your hand</h2>

            <div style="margin: 10px 0;">
                <fieldset>
                    <legend>Winning type</legend>
                    <select data-bind="{value: winningType}">
                        <option value="tsumo">Tsumo</option>
                        <option value="ron">Ron</option>
                    </select>
                    <select data-bind="{value: winningSecondaryType}">
                        <option></option>
                        <option value="haitei raoyue">Haitei Raoyue</option>
                        <option value="houtei raoyui">Houtei Raoyui</option>
                        <option value="rinshan kaihou">Rinshan Kaihou</option>
                        <option value="chan kan">Chan Kan</option>
                    </select>
                </fieldset>
            </div>
            
            <div style="margin: 10px 0;">
                <fieldset>
                    <legend>Winds</legend>
                    
                    <div style="display: inline-block;">
                        <label>Prevalent: </label>
                        <select data-bind="{value: prevalentWind}">
                            <option value="east">East</option>
                            <option value="south">South</option>
                            <option value="west">West</option>
                            <option value="north">North</option>
                        </select>
                    </div>
                    
                    <div style="display: inline-block;">
                        <label>Seat: </label>
                        <select data-bind="{value: seatWind}">
                            <option value="east">East</option>
                            <option value="south">South</option>
                            <option value="west">West</option>
                            <option value="north">North</option>
                        </select>
                    </div>
                </fieldset>
            </div>
            
            <div style="margin: 10px 0;">
                <fieldset>
                    <legend>Riichi</legend>
                    <input type="checkbox" id="IsRiichi" data-bind="{checked: isRiichi}" /><label for="IsRiichi">Riichi</label>
                    <input type="checkbox" id="IsDoubleRiichi" data-bind="{checked: isDoubleRiichi}" /><label for="IsDoubleRiichi">Double Riichi</label>
                    <input type="checkbox" id="IsIppatsu" data-bind="{checked: isIppatsu}" /><label for="IsIppatsu">Ippatsu</label>
                </fieldset>
            </div>
            
            <div style="margin: 10px 0;">
                <fieldset>
                    <legend>Concealed combinaisons</legend>
                    <div data-bind="{visible: !handIsFinish()}">
                        <input type="button" value="+ Pair" data-bind="{click: add.bind($data, true, 'pair')}" />
                        <input type="button" value="+ Pon" data-bind="{click: add.bind($data, true, 'pon')}" />
                        <input type="button" value="+ Kan" data-bind="{click: add.bind($data, true, 'kan')}" />
                        <input type="button" value="+ Chii" data-bind="{click: add.bind($data, true, 'chii')}" />
                    </div>
                    <div class="box" style="margin-top: 10px;" data-bind="template: {name: 'hand-template', foreach: concealedCombinaisons}"></div>
                </fieldset>
            </div>
            
            <div style="margin: 10px 0;">
                <fieldset>
                    <legend>Open combinaisons</legend>
                    <div data-bind="{visible: !handIsFinish()}">
                        <input type="button" value="+ Pon" data-bind="{click: add.bind($data, false, 'pon')}" />
                        <input type="button" value="+ Kan" data-bind="{click: add.bind($data, false, 'kan')}" />
                        <input type="button" value="+ Chii" data-bind="{click: add.bind($data, false, 'chii')}" />
                    </div>
                    <div class="box" style="margin-top: 10px;" data-bind="template: {name: 'hand-template', foreach: openCombinaisons}"></div>
                </fieldset>
            </div>
            
            <div>
                <input type="button" value="Calculate hand points" data-bind="{click: showPoints, visible: handIsFinish}" />
            </div>
        </div>
        
        <div data-bind="{visible: currentView() === 'Result'}">
            <h2>Your hand points</h2>
            <div style="margin-bottom: 20px">
                <input type="button" value="back to your hand" data-bind="click: returnToMain" />
            </div>
            <div class="box" style="margin: 20px 0;">
                <p data-bind="html: pointsTotal"></p>
            
                <p><b>Han:</b> <span data-bind="html: pointsYakuTotal"></span> / <b>Fu:</b> <span data-bind="html: pointsFuTotal"></span></p>
                
                <b>Han details</b><br />
                <table>
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Han value</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: pointsYakuDetails">
                        <tr>
                            <td data-bind="html: name"></td>
                            <td data-bind="html: value"></td>
                        </tr>
                    </tbody>
                </table>
                
                <br /><b>Fu details</b><br />
                <table>
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Fu value</th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: pointsFuDetails">
                        <tr>
                            <td data-bind="html: name"></td>
                            <td data-bind="html: value"></td>
                        </tr>
                    </tbody>
                </table>
            
            </div>
        </div>
    </div>
    
    <script type="text/html" id="hand-template">
    <!-- ko foreach: tiles -->
        <!-- ko if: $index() === $parent.tiles.length-1 && !isWinningTile() -->
        <span class="last" data-bind="click: $root.setWinningTile"><img data-bind="attr: {src: 'img/' + suit + value + '.png'}" /></span>
        <!-- /ko -->
        
        <!-- ko if: $index() === $parent.tiles.length-1 && isWinningTile() -->
        <span class="waiting last" data-bind="click: $root.setWinningTile"><img data-bind="attr: {src: 'img/' + suit + value + '.png'}" /></span>
        <!-- /ko -->
        
        <!-- ko if: $index() !== $parent.tiles.length-1 && isWinningTile() -->
        <span class="waiting" data-bind="click: $root.setWinningTile"><img data-bind="attr: {src: 'img/' + suit + value + '.png'}" /></span>
        <!-- /ko -->
        
        <!-- ko if: $index() !== $parent.tiles.length-1 && !isWinningTile() -->
        <span data-bind="click: $root.setWinningTile"><img data-bind="attr: {src: 'img/' + suit + value + '.png'}" /></span>
        <!-- /ko -->
    <!-- /ko -->
    </script>

    <script src="vendor/knockout-2.3.0.js"></script>
    <script src="src/core/tile-classes.js"></script>    
    <script src="src/core/combinaison-classes.js"></script>
    <script src="src/core/hand-classes.js"></script>
    <script src="src/core/yakupattern-classes.js"></script>
    <script src="src/core/pointer-classes.js"></script>
    <script src="src/gui/RiichiMahjongPointerViewModel.js"></script>
    
    <script>
        // initialize the application
        ko.applyBindings(new RiichiMahjongPointerViewModel());
    </script>
</body>
</html>
