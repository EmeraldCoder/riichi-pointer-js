<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Riichi Mahjong Pointer</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div id="layout">
        <h1>Riichi Mahjong Pointer</h1>
    
        <div id="PageSelectCombinaisonType" style="display: none;">
            <h2>Select the combinaison type to add to your hand</h2>
            
            <input type="button" value="Pair" onclick="selectCombinaisonType('pair')" />
            <input type="button" value="Pon" onclick="selectCombinaisonType('pon')" />
            <input type="button" value="Kan" onclick="selectCombinaisonType('kan')" />
            <input type="button" value="Chii" onclick="selectCombinaisonType('chii')" />
        </div>
        
        <div id="PageSelectTileSuit" style="display: none;">
            <h2>Select type tile type of the combinaison to add to your hand</h2>
            
            <div id="TileSuitForChii">
                <input type="button" value="Dot" onclick="selectTileSuit('dot')" />
                <input type="button" value="Bamboo" onclick="selectTileSuit('bamboo')" />
                <input type="button" value="Character" onclick="selectTileSuit('character')" />
            </div>
            <div id="TileSuitForNonChii">
                <input type="button" value="Dragon" onclick="selectTileSuit('dragon')" />
                <input type="button" value="Wind" onclick="selectTileSuit('wind')" />
                <input type="button" value="Dot" onclick="selectTileSuit('dot')" />
                <input type="button" value="Bamboo" onclick="selectTileSuit('bamboo')" />
                <input type="button" value="Character" onclick="selectTileSuit('character')" />
            </div>        
        </div>
        
        <div id="PageSelectTileValue" style="display: none;">
            <h2>Select the value of the tile of the combinaison to add to your hand</h2>
            
            <div id="TileValueForDragon">
                <input type="button" value="Green" onclick="selectTileValue('green')" />
                <input type="button" value="Red" onclick="selectTileValue('red')" />
                <input type="button" value="White" onclick="selectTileValue('white')" />
            </div>
            <div id="TileValueForWind">
                <input type="button" value="East" onclick="selectTileValue('east')" />
                <input type="button" value="South" onclick="selectTileValue('south')" />
                <input type="button" value="West" onclick="selectTileValue('west')" />
                <input type="button" value="North" onclick="selectTileValue('north')" />
            </div>
            <div id="TileValueForNumbered">
                <input type="button" value="1" onclick="selectTileValue(1)" />
                <input type="button" value="2" onclick="selectTileValue(2)" />
                <input type="button" value="3" onclick="selectTileValue(3)" />
                <input type="button" value="4" onclick="selectTileValue(4)" />
                <input type="button" value="5" onclick="selectTileValue(5)" />
                <input type="button" value="6" onclick="selectTileValue(6)" />
                <input type="button" value="7" onclick="selectTileValue(7)" />
                <input type="button" value="8" onclick="selectTileValue(8)" />
                <input type="button" value="9" onclick="selectTileValue(9)" />
            </div>
            <div id="TileValueForChii">
                <input type="button" value="1" onclick="selectTileValue(1)" />
                <input type="button" value="2" onclick="selectTileValue(2)" />
                <input type="button" value="3" onclick="selectTileValue(3)" />
                <input type="button" value="4" onclick="selectTileValue(4)" />
                <input type="button" value="5" onclick="selectTileValue(5)" />
                <input type="button" value="6" onclick="selectTileValue(6)" />
                <input type="button" value="7" onclick="selectTileValue(7)" />
            </div>
        </div>

        <div id="PageMain">
            <h2>Your hands</h2>

            <div style="margin: 10px 0;">
                <label>Prevalent wind: </label>
                <select id="PrevalentWind">
                    <option value="east">East</option>
                    <option value="south">South</option>
                    <option value="west">West</option>
                    <option value="north">North</option>
                </select>
                
                <label>Seat wind: </label>
                <select id="SeatWind">
                    <option value="east">East</option>
                    <option value="south">South</option>
                    <option value="west">West</option>
                    <option value="north">North</option>
                </select>
            </div>
            
            <div>
                <input id="AddConcealedCombinaisonButton" type="button" value="Add a combinaison to your concealed hand" onclick="add(true)" />
                <input id="AddOpenCombinaisonButton" type="button" value="Add a combinaison to your open hand" onclick="add(false)" />
                <input id="ViewResultButton" type="button" value="Calculate hand points" onclick="refreshHandPoints()" style="display: none;" />
            </div>

            <div id="ConcealedHandTiles" class="box" style="min-height: 100px;"></div>
            <div id="OpenHandTiles" class="box" style="min-height: 100px;"></div>
        </div>
        
        <div id="PageResult" style="display: none">
            <h2>Your hand points</h2>
            <div style="margin-bottom: 20px">
                <input type="button" value="retour Ã  la main" onclick="returnToMain()" />
            </div>
            <div id="HandPoints" class="box"></div>
        </div>
    </div>

    <script src="src/tile-classes.js"></script>    
    <script src="src/hand-classes.js"></script>
    <script src="src/yakupattern-classes.js"></script>
    <script>
        var concealedCombinaisons = [];
        var openCombinaisons = [];
        
        function tileFactory(suit, value) {
            var tile = null;
            if (suit === 'dragon') {
                tile = new DragonTile(value);
            } else if (suit === 'wind') {
                tile = new WindTile(value);
            } else if (suit === 'dot') {            
                tile = new DotTile(value);
            } else if (suit === 'bamboo') {
                tile = new BambooTile(value);
            } else if (suit === 'character') {
                tile = new CharacterTile(value);
            } else {
                alert('tile suit not supported');
            }
            return tile;
        }
        
        function addCombinaison(combinaisonIsConcealed, combinaisonType, suit, value) {
            var combinaison;
            if (combinaisonType === 'pair') {
                combinaison = new Pair(tileFactory(suit, value));
            } else if (combinaisonType === 'pon') {
                combinaison = new Pon(tileFactory(suit, value));
            } else if (combinaisonType === 'kan') {
                combinaison = new Kan(tileFactory(suit, value));
            } else if (combinaisonType === 'chii') {
                combinaison = new Chii(
                    tileFactory(suit, value),
                    tileFactory(suit, value+1),
                    tileFactory(suit, value+2)
                );
            } else {
                alert('combinaisonType not supported');
            }
            if (combinaisonIsConcealed) {
                concealedCombinaisons.push(combinaison);    
            } else {
                openCombinaisons.push(combinaison);
            }
            refreshHandTiles();
            
            var tempHand = new Hand(concealedCombinaisons, openCombinaisons);
            if (tempHand.isFinish()) {
                document.getElementById('AddConcealedCombinaisonButton').style.display = 'none';
                document.getElementById('AddOpenCombinaisonButton').style.display = 'none';
                document.getElementById('ViewResultButton').style.display = 'inline-block';
            } else {
                document.getElementById('AddConcealedCombinaisonButton').style.display = 'inline-block';
                document.getElementById('AddOpenCombinaisonButton').style.display = 'inline-block';
                document.getElementById('ViewResultButton').style.display = 'none';
            }
        }
        
        function returnToMain() {
            document.getElementById('PageResult').style.display = 'none';
            document.getElementById('PageMain').style.display = 'block';
        }
        
        function refreshHandTiles() {
            var concealedHtml = '';
            var openHtml = '';
            for (var i = 0; i < concealedCombinaisons.length; i++) {
                concealedHtml += '<span style="display: inline-block; margin-right: 10px;">';
                for (var j = 0; j < concealedCombinaisons[i].tiles.length; j++) {
                    var tile = concealedCombinaisons[i].tiles[j];
                    if (tile instanceof DragonTile) {
                        concealedHtml = concealedHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.color + '.png" /></span>';
                    } else if (tile instanceof WindTile) {
                        concealedHtml = concealedHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.direction + '.png" /></span>';
                    } else {
                        concealedHtml = concealedHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.number + '.png" /></span>';
                    }
                }
                concealedHtml += '</span>';
            }
            for (var i = 0; i < openCombinaisons.length; i++) {
                openHtml += '<span style="display: inline-block; margin-right: 10px;">';
                for (var j = 0; j < openCombinaisons[i].tiles.length; j++) {
                    var tile = openCombinaisons[i].tiles[j];
                    if (tile instanceof DragonTile) {
                        openHtml = openHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.color + '.png" /></span>';
                    } else if (tile instanceof WindTile) {
                        openHtml = openHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.direction + '.png" /></span>';
                    } else {
                        openHtml = openHtml + '<span style="display: inline-block"><img src="img/' + tile.suit + tile.number + '.png" /></span>';
                    }
                }
                openHtml += '</span>';
            }
            document.getElementById('ConcealedHandTiles').innerHTML = concealedHtml;
            document.getElementById('OpenHandTiles').innerHTML = openHtml;
        }
        
        function refreshHandPoints() {
            var hand = new Hand(
                concealedCombinaisons, 
                openCombinaisons,
                document.getElementById('SeatWind').value,
                document.getElementById('PrevalentWind').value
            );
        
            var patterns = [
                { name: 'TanyaouChuu', checker: new TanyaouChuu() },
                { name: 'Honitsu', checker: new Honitsu() },
                { name: 'Chinitsu', checker: new Chinitsu() },
                { name: 'Honroutou', checker: new Honroutou() },
                { name: 'Iipeikou', checker: new Iipeikou() },
                { name: 'SanShokuDoujun', checker: new SanShokuDoujun() },
                { name: 'Itsu', checker: new Itsu() },
                { name: 'Chanta', checker: new Chanta() },
                { name: 'ChiiToitsu', checker: new ChiiToitsu() },
                { name: 'SanShokuDokou', checker: new SanShokuDokou() },
                { name: 'ToiToiHou', checker: new ToiToiHou() },
                { name: 'ShouSangen', checker: new ShouSangen() },
                { name: 'RyanPeikou', checker: new RyanPeikou() },
                { name: 'JunchanTaiyai', checker: new JunchanTaiyai() },
                { name: 'Fanpai (dragon pon)', checker: new FanpaiDragonPon() },
                { name: 'Fanpai (round wind pon)', checker: new FanpaiRoundWind() },
                { name: 'Fanpai (seat wind pon)', checker: new FanpaiSeatWind() }
            ];
            
            var result = [];
            
            for (var i = 0; i < patterns.length; i++) {
                var pattern = patterns[i];
                var checkResult = pattern.checker.check(hand);
                if (checkResult > 0) {
                    result.push({ name: pattern.checker.japaneseName + ' (' + pattern.checker.englishName + ')', value: checkResult });
                }
            }
            
            var html = '';

            html += '<table>';
            html += '<tr><thead><th>Combinaison name</th><th>Han value</th></thead><tbody>';
            for (var i = 0; i < result.length; i++) {
                html += '<tr><td>' + result[i].name + '</td><td align="center">' + result[i].value + '</td></tr>';
            }
            html += '</tbody></table>';
        
            document.getElementById('HandPoints').innerHTML = html;
            
            document.getElementById('PageMain').style.display = 'none';
            document.getElementById('PageResult').style.display = 'block';
        }
        
        var addCombinaisonIsConcealed = null;
        var addCombinaisonType = null;
        var addTileSuit = null;
        var addTileValue = null;
        function add (isConcealed) {
            addCombinaisonIsConcealed = isConcealed;
            document.getElementById('PageMain').style.display = 'none';
            document.getElementById('PageSelectCombinaisonType').style.display = 'block';
        }
        function selectCombinaisonType (type) {
            addCombinaisonType = type;
            document.getElementById('PageSelectCombinaisonType').style.display = 'none';
            document.getElementById('PageSelectTileSuit').style.display = 'block';
            
            if (addCombinaisonType === 'chii') {
                document.getElementById('TileSuitForChii').style.display = 'block';
                document.getElementById('TileSuitForNonChii').style.display = 'none';
            } else {
                document.getElementById('TileSuitForChii').style.display = 'none';
                document.getElementById('TileSuitForNonChii').style.display = 'block';
            }
        }
        function selectTileSuit (suit) {
            addTileSuit = suit;
            document.getElementById('PageSelectTileSuit').style.display = 'none';
            document.getElementById('PageSelectTileValue').style.display = 'block';
            
            document.getElementById('TileValueForChii').style.display = 'none';
            document.getElementById('TileValueForDragon').style.display = 'none';
            document.getElementById('TileValueForWind').style.display = 'none';
            document.getElementById('TileValueForNumbered').style.display = 'none';
            if (addCombinaisonType === 'chii') {
                document.getElementById('TileValueForChii').style.display = 'block';
            } else {
                if (addTileSuit === 'dragon') {
                    document.getElementById('TileValueForDragon').style.display = 'block';
                } else if (addTileSuit === 'wind') {
                    document.getElementById('TileValueForWind').style.display = 'block';
                } else {
                    document.getElementById('TileValueForNumbered').style.display = 'block';
                }                
            }
        }
        function selectTileValue (value) {
            addTileValue = value;
            addCombinaison(addCombinaisonIsConcealed, addCombinaisonType, addTileSuit, addTileValue);
            document.getElementById('PageSelectTileValue').style.display = 'none';
            document.getElementById('PageMain').style.display = 'block';
        }
    </script>
</body>
</html>

